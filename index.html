<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="chessjs.js"></script>

</head>
<style>
    #app::before{
        content: "";
        background: url('background.jpg') no-repeat center center fixed !important;
        background-size: cover;
        opacity: 0.8;
        position: absolute;
        top: 0px;
        left: 0px;
        right: 0px;
        bottom: 0px;
    }
    #chessboard
    {
        opacity:0.75;
        filter: drop-shadow(20px 20px 20px #000);
    }
    .portrait
    {
        filter: drop-shadow(10px 10px 10px #000);
    }
    .piece
    {
        position: absolute;
        pointer-events: none;
    }
    .canvasID
    {
        position: absolute;
        top:0px;
        left:0px;
        pointer-events: none;
    }
    #backrect
    {
        position:absolute;
        background-color: #000000;
        width : 100%;
        height: 100%;
        z-index:100;
        opacity:80%
    }
    .effectchar
    {
        position:absolute;
        z-index:101;
        width:30%;
        margin-top:2%;
        margin-left:5%;
        pointer-events: none;
        background-color:transparent;
    }

    .effecttext
    {
        position:absolute;
        font-size:50px;
        color: white;
        margin-left:40%;
        margin-top:20%;
        z-index:101;
        font-family: 'TheJamsil5Bold';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2302_01@1.0/TheJamsil5Bold.woff2') format('woff2');
        font-weight: 700;
        font-style: normal;
        text-align: center;

    }
</style>
<body>
<div id="app">
    <v-app>
        <v-main>
            <effect v-bind:kind="effectcase" v-if="effect==1" @check="effectcheck"></effect>
            <v-container>
                <v-row  class="my-10">
                    <v-col cols="2" class="portrait">
                        <v-img class="my-3"
                                src='black.png'
                        ></v-img>

                        <v-img class="my-10"
                                src='white.png'
                        ></v-img>
                    </v-col>

                    <v-col cols="6" offset="1" id="chessboard" ><v-img
                            contain
                            src='chessboard.png' id="picture" @click="mouseClick($event)"
                    > </v-img>
                        <div><img class="piece" height="25%" v-bind:style="{top:yPosition[0], left:xPosition[0]}" src="piece/br.png" v-show="yPosition[0]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[1], left:xPosition[1]}" src="piece/bn.png" v-show="yPosition[1]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[2], left:xPosition[2]}" src="piece/bb.png" v-show="yPosition[2]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[3], left:xPosition[3]}" src="piece/bq.png" v-show="yPosition[3]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[4], left:xPosition[4]}" src="piece/bk.png" v-show="yPosition[4]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[5], left:xPosition[5]}" src="piece/bb.png" v-show="yPosition[5]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[6], left:xPosition[6]}" src="piece/bn.png" v-show="yPosition[6]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[7], left:xPosition[7]}" src="piece/br.png" v-show="yPosition[7]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[8], left:xPosition[8]}" src="piece/bp.png" v-show="yPosition[8]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[9], left:xPosition[9]}" src="piece/bp.png" v-show="yPosition[9]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[10], left:xPosition[10]}" src="piece/bp.png" v-show="yPosition[10]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[11], left:xPosition[11]}" src="piece/bp.png" v-show="yPosition[11]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[12], left:xPosition[12]}" src="piece/bp.png" v-show="yPosition[12]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[13], left:xPosition[13]}" src="piece/bp.png" v-show="yPosition[13]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[14], left:xPosition[14]}" src="piece/bp.png" v-show="yPosition[14]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[15], left:xPosition[15]}" src="piece/bp.png" v-show="yPosition[15]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[16], left:xPosition[16]}" src="piece/wp.png" v-show="yPosition[16]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[17], left:xPosition[17]} "src="piece/wp.png" v-show="yPosition[17]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[18], left:xPosition[18]} "src="piece/wp.png" v-show="yPosition[18]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[19], left:xPosition[19]} "src="piece/wp.png" v-show="yPosition[19]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[20], left:xPosition[20]} "src="piece/wp.png" v-show="yPosition[20]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[21], left:xPosition[21]} "src="piece/wp.png" v-show="yPosition[21]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[22], left:xPosition[22]} "src="piece/wp.png" v-show="yPosition[22]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[23], left:xPosition[23]} "src="piece/wp.png" v-show="yPosition[23]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[24], left:xPosition[24]} "src="piece/wr.png" v-show="yPosition[24]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[25], left:xPosition[25]} "src="piece/wn.png" v-show="yPosition[25]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[26], left:xPosition[26]} "src="piece/wb.png" v-show="yPosition[26]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[27], left:xPosition[27]} "src="piece/wq.png" v-show="yPosition[27]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[28], left:xPosition[28]} "src="piece/wk.png" v-show="yPosition[28]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[29], left:xPosition[29]} "src="piece/wb.png" v-show="yPosition[29]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[30], left:xPosition[30]} "src="piece/wn.png" v-show="yPosition[30]!=0"></img>
                            <img class="piece" height="25%"  v-bind:style="{top:yPosition[31], left:xPosition[31]} "src="piece/wr.png" v-show="yPosition[31]!=0"></img>
                            </div>
                    </v-col>
                </v-row>
            </v-container>
        </v-main>
    </v-app>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.js"></script>

<script>
    Vue.component('effect',{
        props: ['kind'],
//        data: function () {
            //           return 0;
            //      },
            methods: {
            effectcheck() {
                this.$emit('check', 0)
            }
        },
        template:
            '<div><div id="backrect" v-on:click="effectcheck" ></div>' +
            '<img class="effectchar" src="effect/castling.png" v-if="kind==1" ></img>' +
            '<img class="effectchar" src="effect/promotion.png" v-if="kind==2" ></img>' +
            '<div class="effecttext" v-if="kind==1">"명령대로...<br>제 목숨을 바쳐 당신을 지키겠습니다"</div>' +
            '<div class="effecttext" v-if="kind==2">"당신의 여왕이 될께요"</div>'+
            '<img class="effectchar" src="effect/checkmate.png" v-if="kind==3" ></img>'+
            '<div class="effecttext" v-if="kind==3">"체크메이트입니다!"</div>'+
            '<img class="effectchar" src="effect/checkmate.png" v-if="kind==4" ></img>'+
            '<div class="effecttext" v-if="kind==4">"무승부입니다."</div>' +
            '<img class="effectchar" src="effect/checkmate.png" v-if="kind==5" ></img>\'+\n' +
            '<div class="effecttext" v-if="kind==5">"졌습니다."</div></div>'

    });
</script>
<script>
    const chess = new Chess()
    new Vue({
        el: '#app',
        data : {
          xPosition: [
              "-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%", "-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%","-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%","-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%"
          ],
            yPosition : [
               "-7%", "-7%", "-7%", "-7%", "-7%", "-7%", "-7%", "-7%", "4%", "4%","4%", "4%","4%", "4%","4%", "4%","62%","62%","62%","62%","62%","62%","62%","62%","74%","74%","74%","74%","74%","74%","74%","74%"
                ],
            presentnote:0,
            piecemove: [],
            effectcase:1,
            effect:0
        },
        methods : {
            effectcheck(check) {
                this.effect=0;
            },
            mouseClick(event) {
                let note=notation(event.target.offsetWidth, event.target.offsetHeight, event.offsetX, event.offsetY)
                if(this.effect==1)
                {
                    this.effect=0;
                }
                if(chess.moves({square: note}).length!=0) {
                    for(let i=0;i<chess.moves({square: note}).length;i++)
                    {
                        let move=chess.moves({square: note})[i]
                        if(chess.moves({square: note})[i].slice(-1)=="+" || chess.moves({square: note})[i].slice(-1)=="#")
                        {
                            move=chess.moves({square: note})[i].slice(0,chess.moves({square: note})[i].length-1)
                        }
                        if(move=="O-O")
                        {
                            if(chess.turn()=="w")
                            {
                                this.piecemove[i]="cw"
                            }
                            else
                            {
                                this.piecemove[i]="cb"
                            }
                        }
                        else if(move=="O-O-O")
                        {
                            if(chess.turn()=="w")
                            {
                                this.piecemove[i]="qw"
                            }
                            else
                            {
                                this.piecemove[i]="qb"
                            }
                        }
                        else if(move.slice(-1)=="Q")
                        {
                            this.piecemove[i]=move.slice(-4,move.length-2)
                        }
                        else if(move.slice(-1)=="R")
                        {
                            this.piecemove[i]="pr"
                        }
                        else
                        {
                            this.piecemove[i]=move.slice(-2)
                        }
                    }
                    createrect(this.piecemove, event.target.offsetWidth, event.target.offsetHeight)
                    this.presentnote=note;
                }
                else if(this.piecemove.includes(note))
                {
                    let np=notepiece(this.xPosition,this.yPosition,this.presentnote)
                    let i=notepiece(this.xPosition,this.yPosition,note)
                    if(i)
                    {
                        this.xPosition[i]=0
                        this.yPosition[i]=0
                    }
                    if(this.piecemove.includes("pr"))
                    {
                        this.effectcase=2;
                        this.effect=1;
                        let pawn=document.getElementsByClassName("piece")
                        if(chess.turn=='b')
                        {
                            pawn[np].src="./piece/bq.png"
                        }
                        else
                        {
                            pawn[np].src="./piece/wq.png"
                        }
                        this.$set(this.xPosition, np, piecemovex(note))
                        this.$set(this.yPosition, np, piecemovey(note))
                        if(i)
                        {
                            chess.move(this.presentnote.slice(0,1)+"x"+note+"=Q")
                        }
                        else
                        {
                            chess.move(note+"=Q")
                        }
                        this.piecemove.length=0
                        createrect([],event.target.offsetWidth, event.target.offsetHeight)
                    }
                    else
                    {
                        chess.move({from:this.presentnote,to:note})
                        this.$set(this.xPosition, np, piecemovex(note))
                        this.$set(this.yPosition, np, piecemovey(note))
                        this.piecemove.length=0
                        createrect([],event.target.offsetWidth, event.target.offsetHeight)
                    }
                    if(chess.game_over())
                    {
                        if(chess.in_checkmate())
                        {
                           if(chess.turn()=="w")
                           {
                               this.effectcase=5;
                               this.effect=1;
                           }
                           else
                           {
                               this.effectcase=3;
                               this.effect=1;
                           }
                        }
                        if(chess.in_draw())
                        {
                            this.effectcase=4;
                            this.effect=1;
                        }
                        chess.reset()
                        this.xPosition=[
                            "-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%", "-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%","-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%","-1%", "11.5%", "23%", "34.5%", "47%", "59%", "71%", "83%"
                        ];
                        this.yPosition=[
                            "-7%", "-7%", "-7%", "-7%", "-7%", "-7%", "-7%", "-7%", "4%", "4%","4%", "4%","4%", "4%","4%", "4%","62%","62%","62%","62%","62%","62%","62%","62%","74%","74%","74%","74%","74%","74%","74%","74%"
                        ];
                    }
                }
                else if(this.piecemove.includes("cw") && note=="g1")
                {
                    this.effectcase=3;
                    this.effect=1;
                    chess.move("O-O")
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"e1"),piecemovex("g1"))
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"h1"),piecemovex("f1"))
                    createrect([],event.target.offsetWidth, event.target.offsetHeight)
                    this.piecemove.length=0
                }
                else if(this.piecemove.includes("cb") && note=="g8")
                {
                    chess.move("O-O")
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"e8"),piecemovex("g8"))
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"h8"),piecemovex("f8"))
                    createrect([],event.target.offsetWidth, event.target.offsetHeight)
                    this.piecemove.length=0
                }
                else if(this.piecemove.includes("qw") && note=="c1")
                {
                    chess.move("O-O-O")
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"e1"),piecemovex("c1"))
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"a1"),piecemovex("d1"))
                    createrect([],event.target.offsetWidth, event.target.offsetHeight)
                    this.piecemove.length=0
                }
                else if(this.piecemove.includes("qb") && note=="c8")
                {
                    chess.move("O-O")
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"e8"),piecemovex("c8"))
                    this.$set(this.xPosition,notepiece(this.xPosition,this.yPosition,"a8"),piecemovex("d8"))
                    createrect([],event.target.offsetWidth, event.target.offsetHeight)
                    this.piecemove.length=0
                }
            },
        },
        vuetify: new Vuetify(),
    });
</script>
</body>

</html>
